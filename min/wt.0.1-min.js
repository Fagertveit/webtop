var WT={Desk:null,init:function(){this.Desk=new WT.desktop.Desktop();this.Desk.init()}};WT.desktop={Desktop:function(b,c,a){var d={width:b||640,height:c||480,background:a||[245,245,245],portals:new Array(),applications:new Array(),nextId:0,deskId:"desk-cont",init:function(){var e=document.createElement("div");e.setAttribute("id",this.deskId);e.setAttribute("class","desktop");e.style.marginTop="-"+(this.height/2)+"px";e.style.marginLeft="-"+(this.width/2)+"px";e.style.width=this.width+"px";e.style.height=this.height+"px";document.body.appendChild(e)},addPortal:function(e,g){var f=new WT.portal.Portal(g,e,this.deskId,this.nextId);this.nextId++;this.portals.push(f);this.portals[this.portals.length-1].init()},addApplication:function(g){var e=new g(this.nextId);var f=new WT.portal.Portal(e.width,e.height,this.deskId,this.nextId);this.portals[this.nextId]=f;this.applications[this.nextId]=e;this.portals[this.nextId].setTitle(e.title);this.portals[this.nextId].init();this.applications[this.nextId].init();this.nextId++}};return d}};WT.portal={Portal:function(b,c,e,d){var a={width:b||320,height:c||240,parent:e||null,id:d,title:"Untitled",init:function(){var g,h;if(this.parent!=null){g=document.getElementById(this.parent)}else{g=document.body}var j=document.createElement("div");var f=document.createElement("div");var i=document.createElement("div");h=document.createElement("div");h.setAttribute("id","portal-"+this.id);h.setAttribute("class","portal");h.setAttribute("portalid",this.id);h.style.top="100px";h.style.left="10px";h.style.width=this.width+"px";h.style.height=this.height+"px";j.setAttribute("class","close");j.addEventListener("click",this.close,true);i.setAttribute("class","min");f.setAttribute("class","max");h.appendChild(this.generateTitle());h.appendChild(this.generateContainer());h.appendChild(this.generateFoot());h.appendChild(this.generateHandle());h.appendChild(j);h.appendChild(i);h.appendChild(f);g.appendChild(h);this.id=WT.nextId;WT.nextId++},generateTitle:function(){var g=document.createElement("div");var f=document.createElement("div");g.setAttribute("id","portal-titlebar-"+this.id);g.setAttribute("class","title");g.setAttribute("style","background-image: -webkit-linear-gradient(top, #aae, #55a 80%, #aaf 85%);background-image: -moz-linear-gradient(top, #aae, #55a 80%, #aaf 85%);background-image: -ms-linear-gradient(top, #aae, #55a 80%, #aaf 85%);background-image: -o-linear-gradient(top, #aae, #55a 80%, #aaf 85%);background-image: linear-gradient(top, #aae, #55a 80%, #aaf 85%);");g.addEventListener("mousedown",this.move,true);f.setAttribute("id","portal-title-"+this.id);f.innerHTML=this.title;f.style.position="absolute";f.style.left=4+"px";f.style.top=2+"px";f.style.fontSize=12+"px";f.style.color="#000";g.appendChild(f);return g},generateContainer:function(){var f=document.createElement("div");f.setAttribute("id","portal-container-"+this.id);f.setAttribute("class","container");return f},generateFoot:function(){var f=document.createElement("div");f.setAttribute("class","foot");return f},generateHandle:function(){var f=document.createElement("div");f.addEventListener("mousedown",this.resize,true);f.setAttribute("class","handle");return f},setTitle:function(f){this.title=f},updateTitle:function(){var f=document.getElementById("portal-title-"+this.id);f.innerHTML=this.title},move:function(g){var j=g.target.parentNode;var l=g.clientX;var k=g.clientY;var o=j.offsetLeft;var n=j.offsetTop;var i=l-o;var h=k-n;document.addEventListener("mousemove",m,true);document.addEventListener("mouseup",f,true);g.stopPropagation();g.preventDefault();function m(p){j.style.left=(p.clientX-i)+"px";j.style.top=(p.clientY-h)+"px";p.stopPropagation()}function f(p){document.removeEventListener("mouseup",f,true);document.removeEventListener("mousemove",m,true);p.stopPropagation()}},resize:function(g){var k=g.target.parentNode;var m=g.clientX;var l=g.clientY;var p=k.offsetLeft;var o=k.offsetTop;var i=m-p;var h=l-o;var j=k.style.width;j=Number(j.substr(0,j.length-2));var q=k.style.height;q=Number(q.substr(0,q.length-2));document.addEventListener("mousemove",n,true);document.addEventListener("mouseup",f,true);g.stopPropagation();g.preventDefault();function n(r){width=r.clientX-i-p+j;height=r.clientY-h-o+q;if(width>70){k.style.width=width+"px"}else{k.style.width=70+"px"}if(height>70){k.style.height=height+"px"}else{k.style.height=70+"px"}r.stopPropagation()}function f(r){document.removeEventListener("mouseup",f,true);document.removeEventListener("mousemove",n,true);r.stopPropagation()}},close:function(j){var h=j.target.parentNode;var k=h.getAttribute("portalid");var f=document.getElementById("desk-cont");for(var g=0;g<f.childNodes.length;g++){if(f.childNodes[g].getAttribute("portalid")==k){f.removeChild(f.childNodes[g]);break}}WT.Desk.applications[k]=null;WT.Desk.portals[k]=null}};return a}};WT.color={Color:function(d,c,a){var b={r:0||d,g:0||c,b:0||a,h:0,s:0,l:0,setRGB:function(g,f,e){this.r=g;this.g=f;this.b=e},setRed:function(e){this.setRGB(e,this.g,this.b)},setGreen:function(e){this.setRGB(this.r,e,this.b)},setBlue:function(e){this.setRGB(this.r,this.g,e)},setHSL:function(g,f,e){this.h=g;this.s=f;this.l=e},setHue:function(e){this.setHSL(e,this.s,this.l)},setSaturation:function(e){this.setHSL(this.h,e,this.l)},setLight:function(e){this.setHSL(this.h,this.s,e)},RGBtoHSL:function(){var h,j,f;h=this.r;j=this.g;f=this.b;h/=255,j/=255,f/=255;var e=Math.max(h,j,f),g=Math.min(h,j,f);this.h,this.s,this.l=(e+g)/2;if(e==g){this.h=this.s=0}else{var i=e-g;this.s=this.l>0.5?i/(2-e-g):i/(e+g);switch(e){case h:this.h=(j-f)/i+(j<f?6:0);break;case j:this.h=(f-h)/i+2;break;case f:this.h=(h-j)/i+4;break}this.h/=6}},HSLtoRGB:function(){if(this.s==0){this.r=this.g=this.b=this.l}else{function e(j,i,h){if(h<0){h+=1}if(h>1){h-=1}if(h<1/6){return j+(i-j)*6*h}if(h<1/2){return i}if(h<2/3){return j+(i-j)*(2/3-h)*6}return j}var f=this.l<0.5?this.l*(1+this.s):this.l+this.s-this.l*this.s;var g=2*this.l-f;this.r=e(g,f,this.h+1/3);this.g=e(g,f,this.h);this.b=e(g,f,this.h-1/3)}this.r=Math.floor(this.r*255);this.g=Math.floor(this.g*255);this.b=Math.floor(this.b*255)},getHex:function(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)},setHex:function(f){var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(f);this.r=parseInt(e[1],16);this.g=parseInt(e[2],16);this.b=parseInt(e[3],16);this.RGBtoHSL()},toString:function(){return"Color Object | R : "+this.r+", G : "+this.g+", B : "+this.b+"| H : "+this.h+", S : "+this.s+", L : "+this.l+" | Hex : "+this.getHex()},toCSS:function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"}};return b}};WT.gradient={Application:function(a){var b={parent:a,activeColor:0,color:new WT.color.Color(255,255,255),hue:0,gradient:new WT.gradient.Gradient(),width:256,height:242,title:"Gradient Edit 0.2",init:function(){this.gradient.init();this.gradient.sortColor();this.genContainer();this.generateColorStops()},genContainer:function(){var e=document.createElement("div");var d=document.getElementById("portal-container-"+this.parent);var c=this.gradient.colStops[this.activeColor].color;this.color.setRGB(c[0],c[1],c[2]);this.color.RGBtoHSL();e.setAttribute("class","gradient");e.appendChild(this.genPreview());e.appendChild(this.generateGradBar());e.appendChild(this.generateActive());d.appendChild(e)},genPreview:function(){var c=document.createElement("div");c.setAttribute("class","preview");c.setAttribute("id","gen-preview-"+this.parent);this.gradient.sortColor();var d=this.gradient.toString();c.setAttribute("style","background-image: -webkit-"+d+";background-image: -moz-"+d+";background-image: -ms-"+d+";background-image: -o-"+d+";background-image: "+d+";");return c},generateGradBar:function(){var c=document.createElement("div");c.setAttribute("id","select-bar-"+this.parent);c.setAttribute("class","select-bar");return c},generateColorStops:function(){var d=this.gradient.colStops;var c=document.getElementById("select-bar-"+this.parent);for(var e=0;e<d.length;e++){c.appendChild(this.generateColorStop(d[e],d[e].id))}},generateColorStop:function(e,f){var d=document.createElement("div");var c=document.createElement("div");d.setAttribute("class","color-stop");d.setAttribute("color-id",f);d.setAttribute("parent",this.parent);d.setAttribute("id","color-stop-"+this.parent+"-"+f);d.addEventListener("mousedown",this.moveColorStop,true);d.addEventListener("click",this.selectColorStop,true);if(f==this.activeColor){d.style.backgroundImage="url(img/arrow-color-stop-active.png)"}else{d.style.backgroundImage="url(img/arrow-color-stop.png)"}c.setAttribute("class","color-box");c.setAttribute("color-id",f);d.style.left=e.position+"%";d.style.marginLeft="-5px";c.style.backgroundColor=e.toCSS();d.appendChild(c);return d},generateActive:function(){var f=this.gradient.getColorById(this.activeColor);var d=document.createElement("div");d.setAttribute("class","active-color");var e=document.createElement("div");e.setAttribute("class","color-map");e.setAttribute("id","color-map-"+this.parent);e.setAttribute("parent",this.parent);e.style.backgroundColor=f.toCSS();var m=document.createElement("div");m.setAttribute("class","light-map");var g=document.createElement("div");g.setAttribute("class","sat-map");var c=document.createElement("div");c.setAttribute("class","hue-bar");c.setAttribute("parent",this.parent);var k=document.createElement("div");k.setAttribute("class","hue-ind");k.setAttribute("parent",this.parent);k.setAttribute("id","hue-ind-"+this.parent);k.addEventListener("mousedown",this.moveHue,true);var n=document.createElement("div");n.setAttribute("class","color-ind");n.setAttribute("parent",this.parent);n.setAttribute("id","color-ind-"+this.parent);n.addEventListener("mousedown",this.moveSL,true);var i=document.createElement("div");i.setAttribute("class","color-preview");i.setAttribute("id","color-preview-"+this.parent);i.style.backgroundColor=f.toCSS();var l=document.createElement("div");l.setAttribute("class","btn color-add");l.setAttribute("parent",this.parent);l.innerHTML="Add";l.addEventListener("click",this.addColor,true);var j=document.createElement("div");j.setAttribute("class","btn color-del");j.setAttribute("parent",this.parent);j.innerHTML="Remove";j.addEventListener("click",this.removeColor,true);var h=document.createElement("div");h.setAttribute("class","btn color-export");h.setAttribute("parent",this.parent);h.innerHTML="Export";e.appendChild(m);e.appendChild(g);e.appendChild(n);c.appendChild(k);d.appendChild(e);d.appendChild(c);d.appendChild(i);d.appendChild(l);d.appendChild(j);d.appendChild(h);return d},updatePreview:function(){var c=document.getElementById("gen-preview-"+this.parent);var d=this.gradient.toString();c.setAttribute("style","background-image: -webkit-"+d+";background-image: -moz-"+d+";background-image: -ms-"+d+";background-image: -o-"+d+";background-image: "+d+";")},updateGradient:function(){var c=document.getElementById("select-bar-"+this.parent);c.innerHTML="";this.gradient.sortColor();this.updatePreview();this.generateColorStops()},setActiveColor:function(c){this.activeColor=c;var f=document.getElementById("color-preview-"+this.parent);var d=document.getElementById("color-map-"+this.parent);var j=document.getElementById("hue-ind-"+this.parent);var k=document.getElementById("color-ind-"+this.parent);var i;var h;var e=this.gradient.getColorById(this.activeColor);var g=this.color;g.setRGB(e.color[0],e.color[1],e.color[2]);g.RGBtoHSL();i=g.s;h=g.l;h*=2;if(h/2-i/2>0){h-=h/2-i/2}h=Math.abs(h-1);console.log("Active: Light: "+g.l+", Saturation:"+g.s+" ColorIndicator: "+h+" - "+i);h=Math.floor(h*128);i=Math.floor(i*128);k.style.top=h-5+"px";k.style.left=i-5+"px";this.hue=g.h;g.setHSL(this.hue,1,0.5);g.HSLtoRGB();f.style.backgroundColor=e.toCSS();d.style.backgroundColor=g.toCSS();h=g.h;h=Math.abs(h-1);h=Math.floor(h*128);console.log("Active Hue: "+g.h+", Huebar: "+h);j.style.top=h-5+"px"},setActiveSL:function(e){this.activeColor=e;var c=document.getElementById("color-preview-"+this.parent);var d=this.gradient.getColorById(this.activeColor);c.style.backgroundColor=d.toCSS()},testColorRGB:function(i,h,d){var e=document.getElementById("color-preview-"+this.parent);var f=document.getElementById("color-map-"+this.parent);var j=this.gradient.getColorById(this.activeColor);var c=this.color;c.setRGB(i,h,d);e.style.backgroundColor=c.toCSS();f.style.backgroundColor=c.toCSS()},testColorHSL:function(i,g,d){var e=document.getElementById("color-preview-"+this.parent);var f=document.getElementById("color-map-"+this.parent);var j=this.gradient.getColorById(this.activeColor);var c=this.color;c.setHSL(i,g,d);c.HSLtoRGB();e.style.backgroundColor=c.toCSS();f.style.backgroundColor=c.toCSS()},selectColorStop:function(d){var f=d.target.getAttribute("color-id");var c=d.target.getAttribute("parent");WT.Desk.applications[c].setActiveColor(f)},moveColorStop:function(i){var d=i.target;if(i.target.getAttribute("class")=="color-box"){d=i.target.parentNode}var k=d.getAttribute("parent");WT.Desk.applications[k].setActiveColor(d.getAttribute("color-id"));var j=document.getElementById("select-bar-"+k);var l=j.clientWidth;var g=i.clientX;var f=g-d.offsetLeft;document.addEventListener("mousemove",h,true);document.addEventListener("mouseup",c,true);i.stopPropagation();i.preventDefault();function h(n){var o;if(n.clientX>f+l){o=100}else{if(n.clientX<f){o=0}else{o=n.clientX-f+8;o/=l;o*=100;o=Math.floor(o)}}if(o>100){o=100}if(o<0){o=0}d.style.left=o+"%";var m=WT.Desk.applications[k].gradient.getColorById(WT.Desk.applications[k].activeColor);m.position=o;WT.Desk.applications[k].gradient.setColorById(WT.Desk.applications[k].activeColor);WT.Desk.applications[k].updateGradient();n.stopPropagation();n.preventDefault()}function c(m){document.removeEventListener("mouseup",c,true);document.removeEventListener("mousemove",h,true);WT.Desk.applications[k].updateGradient();m.stopPropagation();m.preventDefault()}},moveSL:function(s){var p=s.target.parentNode;var k=p.getAttribute("parent");var j=document.getElementById("color-ind-"+k);var c;var d;var f=WT.Desk.applications[k].hue;var h=WT.Desk.applications[k].gradient.getColorById(WT.Desk.applications[k].activeColor);var o=new WT.color.Color(h.color[0],h.color[1],h.color[2]);var m,l,g;o.RGBtoHSL();var r=s.clientX;var q=s.clientY;var u=r-j.offsetLeft;var t=q-j.offsetTop;document.addEventListener("mousemove",n,true);document.addEventListener("mouseup",i,true);s.stopPropagation();s.preventDefault();function n(v){if(v.clientY>t+123){l=0;j.style.top=123+"px"}else{if(v.clientY<t){l=1;j.style.top=-5+"px"}else{l=(v.clientY-t)/123;l-=1;l=Math.abs(l);j.style.top=v.clientY-t+"px"}}if(v.clientX>u+123){m=1;j.style.left=123+"px"}else{if(v.clientX<u){m=0;j.style.left=-5+"px"}else{m=(v.clientX-u)/123;j.style.left=v.clientX-u+"px"}}c=m;o.setSaturation(c);d=l/2;if(l/2-m/2>0){d+=l/2-m/2}o.setLight(d);o.HSLtoRGB();h.color[0]=o.r;h.color[1]=o.g;h.color[2]=o.b;o.setHue(f);WT.Desk.applications[k].gradient.setColorById(WT.Desk.applications[k].activeColor);WT.Desk.applications[k].setActiveSL(WT.Desk.applications[k].activeColor);WT.Desk.applications[k].updateGradient();v.stopPropagation();v.preventDefault()}function i(v){document.removeEventListener("mouseup",i,true);document.removeEventListener("mousemove",n,true);v.stopPropagation();v.preventDefault()}},moveHue:function(l){var d=l.target.parentNode;var n=l.target;var j;var m=d.getAttribute("parent");var f=WT.Desk.applications[m].gradient.getColorById(WT.Desk.applications[m].activeColor);var h=WT.Desk.applications[m].color;h.setRGB(f.color[0],f.color[1],f.color[2]);var i=l.clientY;var g=i-n.offsetTop-5;document.addEventListener("mousemove",k,true);document.addEventListener("mouseup",c,true);l.stopPropagation();l.preventDefault();function k(o){if(o.clientY>g+128){j=0;n.style.top=123+"px"}else{if(o.clientY<g){j=0.993;n.style.top=-5+"px"}else{j=(o.clientY-g+1)/128;j-=1;j=Math.abs(j);n.style.top=o.clientY-g+"px"}}h.setHue(j);WT.Desk.applications[m].hue=j;h.HSLtoRGB();f.color[0]=h.r;f.color[1]=h.g;f.color[2]=h.b;WT.Desk.applications[m].gradient.setColorById(WT.Desk.applications[m].activeColor);WT.Desk.applications[m].setActiveColor(WT.Desk.applications[m].activeColor);WT.Desk.applications[m].updateGradient();o.stopPropagation();o.preventDefault()}function c(o){document.removeEventListener("mouseup",c,true);document.removeEventListener("mousemove",k,true);o.stopPropagation();o.preventDefault()}},removeColor:function(d){var c=d.target.getAttribute("parent");WT.Desk.applications[c].activeColor=WT.Desk.applications[c].gradient.removeOldColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()},addColor:function(d){var c=d.target.getAttribute("parent");WT.Desk.applications[c].activeColor=WT.Desk.applications[c].gradient.addNewColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()},changeRed:function(g){var c=g.target.getAttribute("parent");var d=g.target.value;var f=WT.Desk.applications[c].gradient.getColorById(WT.Desk.applications[c].activeColor);f.color[0]=d;WT.Desk.applications[c].gradient.setColorById(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()},changeBlue:function(g){var c=g.target.getAttribute("parent");var d=g.target.value;var f=WT.Desk.applications[c].gradient.getColorById(WT.Desk.applications[c].activeColor);f.color[1]=d;WT.Desk.applications[c].gradient.setColorById(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()},changeGreen:function(g){var c=g.target.getAttribute("parent");var d=g.target.value;var f=WT.Desk.applications[c].gradient.getColorById(WT.Desk.applications[c].activeColor);f.color[2]=d;WT.Desk.applications[c].gradient.setColorById(b.activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()},changePos:function(g){var c=g.target.getAttribute("parent");var d=g.target.value;var f=WT.Desk.applications[c].gradient.getColorById(WT.Desk.applications[c].activeColor);f.position=d;WT.Desk.applications[c].gradient.setColorById(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].setActiveColor(WT.Desk.applications[c].activeColor);WT.Desk.applications[c].updateGradient()}};return b},Gradient:function(){var a={colStops:new Array(),start:"left",nextId:0,init:function(){this.addColor([255,255,0],0,"%");this.addColor([0,0,255],40,"%");this.addColor([255,0,255],70,"%");this.addColor([255,0,0],50,"%");this.addColor([0,0,0],100,"%")},addColor:function(b,e,d){var c=new WT.gradient.ColorStop(b,e,d,this.nextId);this.nextId++;this.colStops.push(c)},addNewColor:function(b){var g;var c;var d;var j;var e;var h;for(var f=0;f<this.colStops.length;f++){if(this.colStops[f].id==b){g=this.colStops[f];if(this.colStops.length>f+1){c=this.colStops[f+1]}else{c=this.colStops[f-1]}}}if(g.color[0]>c.color[0]){var k=g.color[0]-c.color[0];d=Math.floor(c.color[0]+(k/2))}else{var k=c.color[0]-g.color[0];d=Math.floor(g.color[0]+(k/2))}if(g.color[1]>c.color[1]){var k=g.color[1]-c.color[1];j=Math.floor(c.color[1]+(k/2))}else{var k=c.color[1]-g.color[1];j=Math.floor(g.color[1]+(k/2))}if(g.color[2]>c.color[2]){var k=g.color[0]-c.color[2];e=Math.floor(c.color[2]+(k/2))}else{var k=c.color[2]-g.color[2];e=Math.floor(g.color[2]+(k/2))}if(g.position>c.position){var k=g.position-c.position;h=Math.floor(c.position+(k/2))}else{var k=c.position-g.position;h=Math.floor(g.position+(k/2))}var k=new WT.gradient.ColorStop([d,j,e],h,"%",this.nextId);this.nextId++;this.colStops.push(k);return k.id},getColorById:function(c){for(var b=0;b<this.colStops.length;b++){if(this.colStops[b].id==c){return this.colStops[b]}}},setColorById:function(b,d){for(var c=0;c<this.colStops.length;c++){if(this.colStops[c].id==d){this.colStops[c]==b;break}}},removeColor:function(c){for(var b=0;b<this.colStops.length;b++){if(this.colStops[b].id==c){this.colStops.splice(b,1);break}}},removeOldColor:function(c){if(this.colStops.length==2){return c}else{for(var b=0;b<this.colStops.length;b++){if(this.colStops[b].id==c){this.colStops.splice(b,1);if(this.colStops.length>b){return this.colStops[b].id}else{return this.colStops[b-1].id}}}}},sortColor:function(e){var d=new Array();var c=this.colStops;var b;while(c.length!=0){b=this.findLowest(c);d.push(b[0]);c.splice(b[1],1)}this.colStops=d},findLowest:function(d){var c=new Array();c[0]=d[0];c[1]=0;for(var b=1;b<d.length;b++){if(c[0].position>d[b].position){c[0]=d[b];c[1]=b}}return c},toString:function(){var c;c="linear-gradient("+this.start;for(var b=0;b<this.colStops.length;b++){c+=", "+this.colStops[b].toString()}c+=")";return c}};return a},ColorStop:function(b,e,a,c){var d={position:e||0,color:b||[255,255,255],posType:a||"%",id:c||0,setColors:function(f){this.color[0]=f[0];this.color[1]=f[1];this.color[2]=f[2]},setPosition:function(g,f){this.position=g;this.posType=f},toString:function(){return"rgb("+this.color[0]+", "+this.color[1]+", "+this.color[2]+") "+this.position+this.posType},toCSS:function(){return"rgb("+this.color[0]+", "+this.color[1]+", "+this.color[2]+")"}};return d}};