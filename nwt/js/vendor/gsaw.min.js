/**
 * GameSaw HTML5 Game Library - Core *
 * * * * * * * * * * * * * * * * * * *
 * This is the core class of the GameSaw game library, here we initalize the main container
 * of our application, the canvas. Then we use one of the renderers and connect that to
 * the canvas we've choosen. After this it's all up to the user to use the canvas as he/she
 * wish!
 * Dependencies: gsaw.2drenderer.js
 */var gSaw={UID:0,CANVAS_ID:"{gscanvas-} + uid",CANVAS_CONTAINER:"gscontainer",CANVAS_WIDTH:"640",CANVAS_HEIGHT:"480",RENDERER:"2d",TARGET_FPS:60,CORE_TIMER_ID:0,FPS:0,LASTUPDATE:0,FRAMES:0,LASTDELTA:0,CORE_SURFACE:null,SURFACES:{},RESOURCE_MANAGERS:{},CURRENT_CONTEXT:null,CORE_MOUSE_MANAGER:null,CORE_KEY_MANAGER:null,CORE_TOUCH_MANAGER:null,CORE_AUDIO_FORMAT:null,DEBUG:!0,SHOW_FPS:!0,C_LOG:new Array,UI_COOLDOWN:500,setDefault:function(e,t){gSaw[e]=t},getDefault:function(e){return gSaw[e]},init:function(){gSaw.log("Initalizing GameSaw!","Core"),gSaw.CANVAS_ID="gscanvas-"+gSaw.UID,gSaw.checkAudioCapabilities(),gSaw.log("Generating core surface!","Core"),gSaw.CORE_SURFACE=new gsSurface(gSaw.CANVAS_ID,gSaw.CANVAS_WIDTH,gSaw.CANVAS_HEIGHT),gSaw.UID+=1,gSaw.CORE_SURFACE.generateCanvas(),gSaw.log("Creating core resource manager.","Core"),gSaw.RESOURCE_MANAGERS.core=new gSaw.resource.ResourceManager,gSaw.CORE_MOUSE_MANAGER=new gSaw.event.MouseManager(gSaw.CANVAS_ID),gsMouse=gSaw.CORE_MOUSE_MANAGER,gSaw.CORE_KEY_MANAGER=new gSaw.event.KeyManager},checkAudioCapabilities:function(){var e=new Audio;!!e.canPlayType&&""!=e.canPlayType('audio/ogg; codecs="vorbis"')&&(gSaw.CORE_AUDIO_FORMAT=".ogg"),!!e.canPlayType&&""!=e.canPlayType("audio/mpeg")&&(gSaw.CORE_AUDIO_FORMAT=".mp3"),gSaw.CORE_AUDIO_FORMAT||(gSaw.CORE_AUDIO_FORMAT="none"),gSaw.log("GameSaw can play the following format: "+gSaw.CORE_AUDIO_FORMAT,"Core")},start:function(e){clearInterval(gSaw.CORE_TIMER_ID),gSaw.log("Setting time interval at: "+gSaw.TARGET_FPS,"Core");var t=(new Date).getTime();gSaw.LASTDELTA=t,gSaw.CORE_TIMER_ID=setInterval(function(){gSaw.loop(e)},1e3/gSaw.TARGET_FPS)},loop:function(e){gSaw.CURRENT_CONTEXT=gSaw.CORE_SURFACE.getContext();var t=(new Date).getTime();delta=t-gSaw.LASTDELTA,gSaw.LASTDELTA=t,e.update(delta),gSaw.CURRENT_CONTEXT.clearRect(0,0,gSaw.CANVAS_WIDTH,gSaw.CANVAS_HEIGHT),e.render(gSaw.CURRENT_CONTEXT,delta),gSaw.updateFPS(t),gSaw.SHOW_FPS&&gSaw.renderFPS(gSaw.CURRENT_CONTEXT),gSaw.C_LOG.lenght!=0&&gSaw.renderCLog(gSaw.CURRENT_CONTEXT)},renderFPS:function(e){e.save(),e.textAlign="left",e.font="14px Bold Verdana",e.style="black",e.fillText("FPS: "+gSaw.getFPS(),10,20),e.restore()},updateFPS:function(e){e-gSaw.LASTUPDATE>1e3?(gSaw.FPS=gSaw.FRAMES,gSaw.FRAMES=0,gSaw.LASTUPDATE=e):gSaw.FRAMES++},getFPS:function(){return gSaw.FPS},log:function(e,t){if(gSaw.DEBUG){var n=new Date,r=n.toLocaleDateString()+" "+n.toLocaleTimeString();window.console.log(r+" | "+t+" - "+e)}},cLog:function(e,t){var n=t+" - "+e;gSaw.C_LOG.push(n)},renderCLog:function(e){var t,n,r;t=0,r=30,lenght=gSaw.C_LOG.length;if(gSaw.Debug)for(t;t<n;t+=1)e.fillText(gSaw.C_LOG.pop(),10,r),r+=20},addResourceManager:function(e){gSaw.RESOURCE_MANAGERS[e]=new gSaw.resource.ResourceManager},addSurface:function(e){},CoreApplication:function(){return coreApp={surface:null,init:function(){},update:function(e){},render:function(e,t){e.fillText("Testing",100,100)}},coreApp}};typeof gs=="undefined"?gs=gSaw:gSaw.log("Shorthand occupied, use the longhand instead!","Core"),gSaw.resource={ResourceManager:function(){var e={resources:new Object,resource_id:1,ready:!0,addResource:function(e){gSaw.log("Adding resource of type: "+e+" with resource id: "+this.resource_id,"Resource Manager");var t=new gSaw.resource.Resource(this.resource_id,e);return this.resources[this.resource_id]=t,this.resource_id+=1,this.ready=!1,t.id},flagReady:function(e){var t=this.resources[e];gSaw.log("Resource "+t.id+" of type "+t.type+" is ready to use.","Resource Manager"),this.resources[e].setReady(!0),this.ready=this.checkReady()},getProgress:function(){var e;for(resource in this.resources)resource[resource].ready&&(e+=1);return e/this.resources.length},checkReady:function(){for(resource in this.resources)if(!this.resources[resource].ready)return!1;return!0}};return gSaw.log("Resource manager ready to use.","Resource Manager"),e},Resource:function(e,t){var n={id:e,type:t,ready:!1,setReady:function(e){this.ready=e}};return n}},gsResourceManager=gSaw.resource.ResourceManager,gsResource=gSaw.resource.Resource,gSaw.renderer={Surface:function(e,t,n){return surface={context:null,canvas:e||null,updateEach:1,width:t||0,height:n||0,getContext:function(){return document.getElementById(this.canvas).getContext("2d")},setToDefault:function(){gSaw.CURRENT_CONTEXT=this.getContext()},generateCanvas:function(){var e,t,e=document.createElement("canvas"),t=document.getElementById(gSaw.CANVAS_CONTAINER);e.setAttribute("width",this.width),e.setAttribute("height",this.height),e.setAttribute("id",this.canvas),t?(t.appendChild(e),gSaw.log("Generated Canvas element, ready to draw!","2D Surface")):gSaw.log("Container element not found, be sure to have a DOM element with the id: '"+gSaw.CANVAS_CONTAINER+"'","2D Surface")},clear:function(){this.getContext().clearRect(0,0,this.width,this.height)}},surface}},typeof gsSurface=="undefined"?gsSurface=gSaw.renderer.Surface:gSaw.log("Shorthand is occupied, use longhand","2D Surface"),gSaw.event={KEY:{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS:20,ESCAPE:27,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,Y:88,X:89,Z:90,LEFTSUPER:91,RIGHTSUPER:92,SELECT:93,NUM0:96,NUM1:97,NUM2:98,NUM3:99,NUM4:100,NUM5:101,NUM6:102,NUM7:103,NUM8:104,NUM9:105,MULTIPLY:106,ADD:107,SUBSTRACT:108,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLLLOCK:145,SEMICOLON:186,EQUAL:187,COMMA:188,DASH:189,PERIOD:190,FORWARDSLASH:191,GRAVEACCENT:192,OPENBRACKET:219,BACKSLASH:220,CLOSEBRAKET:221,SINGLEQUOTE:222},MouseManager:function(t){var n={X:0,Y:0,MB:[3],PREVENT_DEFAULT:!0,STOP_PROPAGATION:!0,TARGET:t||null,init:function(){var e,t;t=this,e=document.getElementById(this.TARGET),this.MB[0]=!1,this.MB[1]=!1,this.MB[2]=!1,gSaw.log("Initializing mouse position tracker.","Event"),e.addEventListener("mousemove",function(e){t.setMousePosition(t,e)},!0),gSaw.log("Initializing mouse button tracker.","Event"),e.addEventListener("mousedown",function(e){t.setMouseDown(t,e)},!0),e.addEventListener("mouseup",function(e){t.setMouseUp(t,e)},!0)},setMouseDown:function(e,t){e.PREVENT_DEFAULT&&t.preventDefault(),e.STOP_PROPAGATION&&t.stopPropagation(),e.MB[t.button]=!0},setMouseUp:function(e,t){e.PREVENT_DEFAULT&&t.preventDefault(),e.STOP_PROPAGATION&&t.stopPropagation(),e.MB[t.button]=!1},setMousePosition:function(t,n){n.pageX!=undefined&&n.pageY!=undefined?(t.X=n.pageX,t.Y=n.pageY):(t.X=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,t.Y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),t.X-=document.getElementById(t.TARGET).offsetLeft,t.Y-=document.getElementById(t.TARGET).offsetTop}};return n.init(),n},KeyManager:function(e){var t={KEYS:[256],TARGET:e||window,PREVENT_DEFAULT:!1,STOP_PROPAGATION:!1,KEY_LOGGER:!1,init:function(){var e,t;e=this,t=document.getElementById(e.TARGET),gSaw.log("Initializing keyboard tracker","Event"),window.addEventListener("keydown",function(t){e.setKeyDown(e,t)},!0),window.addEventListener("keyup",function(t){e.setKeyUp(e,t)},!0)},setKeyDown:function(e,t){e.PREVENT_DEFAULT&&t.preventDefault(),e.STOP_PROPAGATION&&t.stopPropagation(),e.KEY_LOGGER&&gSaw.log("Pressed key: "+gSaw.event.KEY[t.keyCode]+" keycode: "+t.keyCode,"Event"),e.KEYS[t.keyCode]=!0},setKeyUp:function(e,t){e.PREVENT_DEFAULT&&t.preventDefault(),e.STOP_PROPAGATION&&t.stopPropagation(),e.KEY_LOGGER&&gSaw.log("Released key: "+t.keyCode,"Event"),e.KEYS[t.keyCode]=!1}};return t.init(),t},TouchManager:function(){var e={};return e}},gsMouseManager=gSaw.event.MouseManager,gsKeyManager=gSaw.event.KeyManager,gsTouchManager=gSaw.event.TouchManager,gsKey=gSaw.event.KEY,gSaw.image={Image:function(e,t){return image={img:new Image,src:e||"",ready:!1,width:0,height:0,manager:t||"core",res_id:0,load:function(){var e=this;this.img.src=this.src,this.res_id=gSaw.RESOURCE_MANAGERS[this.manager].addResource("Image"),this.img.addEventListener("load",function(){e.loaded()},!0)},loaded:function(){gSaw.RESOURCE_MANAGERS[this.manager].flagReady(this.res_id),this.width=this.img.width,this.height=this.img.height,this.ready=!0},getData:function(){var e,t,n,e=document.createElement("canvas");return e.width=this.width,e.height=this.height,t=e.getContext("2d"),t.drawImage(this.img,0,0),t.getImageData(0,0,this.width,this.height)},render:function(e,t){this.ready&&gSaw.CURRENT_CONTEXT.drawImage(this.img,e,t)},renderSub:function(e,t,n,r,i,s){this.ready&&gSaw.CURRENT_CONTEXT.drawImage(this.img,n,r,i,s,e,t,i,s)},renderAngle:function(e,t,n){var r=gSaw.CURRENT_CONTEXT;r.save(),r.translate(e,t),r.rotate(n),this.render(0,0),r.translate(-e,-t),r.restore()}},image.load(),image},Animation:function(e,t,n,r,i,s,o){var u={img:e,columns:0,rows:0,frames:t,currentFrame:1,fWidth:n,fHeight:r,delay:i,time:0,loop:s,alive:!0,ready:!1,load:function(){this.columns=this.img.width/this.fWidth,this.rows=this.img.height/this.fHeight,this.ready=!0},render:function(e,t,n){this.alive&&this.ready?(this.time+=n,this.time>this.delay&&(this.time=0,this.currentFrame+=1,this.currentFrame>this.frames&&(this.loop?this.currentFrame=1:this.alive=!1)),col=this.currentFrame%this.columns,row=Math.floor(this.currentFrame/this.columns),this.img.renderSub(e,t,col*this.fWidth,row*this.fHeight,this.fWidth,this.fHeight)):this.img.ready&&!this.ready&&this.load()}};return u},nearest:function(e,t){},linear:function(e,t){},multiply:function(e,t){}},typeof gsImage=="undefined"?(gsImage=gSaw.image.Image,gsAnimation=gSaw.image.Animation,gsNear=gSaw.image.nearest,gsLinear=gSaw.image.linear,gsMultiply=gSaw.image.multiply):window.console.log("gsImage is already in use, use the longhand command instead!"),gSaw.audio={TRACK_VOLUME:10,SAMPLE_VOLUME:10,Sample:function(e,t){var n={audio:new Audio,src:e,res_id:0,manager:t||"core",ready:!1,init:function(){var e=this;gSaw.CORE_AUDIO_FORMAT!="none"&&(this.audio.src=this.src+gSaw.CORE_AUDIO_FORMAT),this.res_id=gSaw.RESOURCE_MANAGERS[this.manager].addResource("Audio Sample"),this.audio.addEventListener("canplaythrough",function(){e.loaded()})},loaded:function(){this.ready=!0,gSaw.RESOURCE_MANAGERS[this.manager].flagReady(this.res_id)},play:function(){this.audio.play()},pause:function(){this.audio.pause()},setLoop:function(e){this.audio.loop=e},getLoop:function(){return this.audio.loop}};return n.init(),n},Track:function(e,t){var n={audio:new Audio,src:e,res_id:0,manager:t||"core",ready:!1,init:function(){var e=this;gSaw.CORE_AUDIO_FORMAT!="none"&&(this.audio.src=this.src+gSaw.CORE_AUDIO_FORMAT),this.res_id=gSaw.RESOURCE_MANAGERS[this.manager].addResource("Audio Track"),this.audio.addEventListener("canplay",function(){e.loaded()},!0)},loaded:function(){this.ready=!0,gSaw.RESOURCE_MANAGERS[this.manager].flagReady(this.res_id)},play:function(){this.audio.play()},pause:function(){this.audio.pause()},setLoop:function(e){this.audio.loop=e},getLoop:function(){return this.audio.loop}};return n.init(),n},setTrackVolume:function(e){},setSampleVolume:function(e){}},gsSample=gSaw.audio.Sample,gsTrack=gSaw.audio.Track,gSaw.geometry={Point:function(e,t){var n={X:e||0,Y:t||0,setPosition:function(e,t){this.X=e,this.Y=t},getPosition:function(){return{X:this.X,Y:this.Y}},setX:function(e){this.X=e},setY:function(e){this.Y=e},getX:function(){return this.X},getY:function(){return this.Y},transform:function(e,t){this.X+=e,this.Y+=t},render:function(){var e=gSaw.CURRENT_CONTEXT;e.beginPath(),e.arc(this.X,this.Y,1,2*Math.PI,!1),e.fill()}};return n},Line:function(e,t,n,r){var i={POINT1:new gSaw.geometry.Point(e,t),POINT2:new gSaw.geometry.Point(n,r),setPosition:function(e,t,n,r){this.POINT1.setPosition(e,t),this.POINT2.setPosition(n,r)},getPosition:function(){return{X1:this.POINT1.X,Y1:this.POINT1.Y,X2:this.POINT2.X,Y2:this.POINT2.Y}},setStartPoint:function(e,t){this.POINT1.setPosition(e,t)},setEndPoint:function(e,t){this.POINT2.setPosition(e,t)},getStart:function(){return{X:this.POINT1.X,Y:this.POINT1.Y}},getEnd:function(){return{X:this.POINT2.X,Y:this.POINT2.Y}},transform:function(e,t){this.POINT1.transform(e,t),this.POINT2.transform(e,t)},transformStart:function(e,t){this.POINT1.transform(e,t)},transformEnd:function(e,t){this.POINT2.transform(e,t)},getPoint:function(e){var t,n;return e!=0?(t=this.POINT1.X+(this.POINT2.X-this.POINT1.X)*e,n=this.POINT1.Y+(this.POINT2.Y-this.POINT1.Y)*e):(t=this.POINT1.X,n=this.POINT1.Y),new gSaw.geometry.Point(t,n)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.beginPath(),e.moveTo(this.POINT1.X,this.POINT1.Y),e.lineTo(this.POINT2.X,this.POINT2.Y),e.stroke()},renderEdit:function(){var e=gSaw.CURRENT_CONTEXT;e.beginPath(),e.moveTo(this.POINT1.X,this.POINT1.Y),e.lineTo(this.POINT2.X,this.POINT2.Y),e.stroke(),e.fillRect(this.POINT1.X-3,this.POINT1.Y-3,6,6),e.fillRect(this.POINT2.X-3,this.POINT2.Y-3,6,6)}};return i},Rectangle:function(e,t,n,r){var i={POS:new gSaw.geometry.Point(e,t),WIDTH:n||10,HEIGHT:r||10,setPosition:function(e,t){this.POS.setPosition(e,t)},getPosition:function(){return{X:this.POS.X,Y:this.POS.Y}},setWidth:function(e){this.WIDTH=e},setHeight:function(e){this.HEIGHT=e},getWidth:function(){return this.WIDTH},getHeight:function(){return this.HEIGHT},transform:function(e,t){this.POS.transform(e,t)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.strokeRect(this.POS.X,this.POS.Y,this.WIDTH,this.HEIGHT)}};return i},Circle:function(e,t,n){var r={POS:new gSaw.geometry.Point(e,t),RADIUS:n,setPosition:function(e,t){this.POS.setPosition(e,t)},getPosition:function(){return{X:this.POS.X,Y:this.POS.Y}},setRadius:function(e){this.RADIUS=e},getRadius:function(){return this.RADIUS},render:function(){var e=gSaw.CURRENT_CONTEXT;e.beginPath(),e.arc(this.POS.X,this.POS.Y,this.RADIUS,2*Math.PI,!1),e.stroke()},fill:function(){var e=gSaw.CURRENT_CONTEXT;e.beginPath(),e.arc(this.POS.X,this.POS.Y,this.RADIUS,2*Math.PI,!1),e.fill()}};return r},Polygon:function(){var e={POINTS:new Array,addPoint:function(e,t){var n=new gSaw.geometry.Point(e,t);this.POINTS.push(n)},removePoint:function(e){this.POINTS.slice(e,1)},removeLast:function(){this.POINTS.pop()},removeFirst:function(){this.POINTS.shift()},transform:function(e,t){var n,r;r=this.POINTS.length;for(n=0;r<n;n+=1)this.POINTS[n].transform(e,t)},setPointPosition:function(e,t,n){this.POINTS[e].setPosition(t,n)},getPointPosition:function(e){return{X:this.POINTS[e].X,Y:this.POINTS[e].Y}},isValid:function(){return this.POINTS.length>=3?!0:!1},render:function(){var e=gSaw.CURRENT_CONTEXT;if(this.isValid()){var t,n;n=this.POINTS.length,e.beginPath(),e.moveTo(this.POINTS[0].X,this.POINTS[0].Y);for(var t=1;t<n;t+=1)e.lineTo(this.POINTS[t].X,this.POINTS[t].Y);e.lineTo(this.POINTS[0].X,this.POINTS[0].Y),e.stroke()}},fill:function(){var e=gSaw.CURRENT_CONTEXT;if(this.isValid()){var t,n;n=this.POINTS.length,e.beginPath(),e.moveTo(this.POINTS[0].X,this.POINTS[0].Y);for(var t=1;t<n;t+=1)e.lineTo(this.POINTS[t].X,this.POINTS[t].Y);e.lineTo(this.POINTS[0].X,this.POINTS[0].Y),e.closePath(),e.fill()}}};return e},AABB:function(e,t,n,r){return aabb={POS:new gSaw.geometry.Point(e,t),HALFWIDTH:n||10,HALFHEIGHT:r||10,setPosition:function(e,t){this.POS.setPosition(e,t)},getPosition:function(){return{X:this.POS.X,Y:this.POS.Y}},setHalfWidth:function(e){this.HALFWIDTH=e},setWidth:function(e){this.HALFWIDTH=e/2},setHalfHeight:function(e){this.HALFHEIGHT=e},setHeight:function(e){this.HALFHEIGHT=e/2},getHalfWidth:function(){return this.HALFWIDTH},getWidth:function(){return this.HALFWIDTH*2},getHalfHeight:function(){return this.HALFHEIGHT},getHeight:function(){return this.HALFHEIGHT*2},transform:function(e,t){this.POS.transform(e,t)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.strokeRect(this.POS.X-this.HALFWIDTH,this.POS.Y-this.HALFHEIGHT,this.HALFWIDTH*2,this.HALFHEIGHT*2)}},aabb},Vector2d:function(e,t){var n={X:e||0,Y:t||0,setPosition:function(e,t){this.X=e,this.Y=t},getPosition:function(){return{X:this.X,Y:this.Y}},setX:function(e){this.X=e},setY:function(e){this.Y=e},add:function(e){return new gSaw.geometry.Vector2d(this.X+e.X,this.Y+e.Y)},subtract:function(e){return new gSaw.geometry.Vector2d(this.X-e.X,this.Y-e.Y)},invert:function(){return new gSaw.geometry.Vector2d(-this.X,-this.Y)},scale:function(e){return new gSaw.geometry.Vector2d(this.X*e,this.Y*e)},dot:function(e){return this.X*e.X+this.Y*e.Y},cross:function(e){return this.X*e.Y-this.Y*e.X},length:function(){return Math.sqrt(this.lengthSquared())},lengthSquared:function(){return this.X*this.X+this.Y*this.Y},normalize:function(){var e=this.length();return e==0?new gSaw.geometry.Vector2d(0,0):new gSaw.geometry.Vector2d(this.X/e,this.Y/e)},project:function(e){var t,n;return t=this.dot(e),n=this.lengthSquared(),new gSaw.geometry.Vector2d(t/n*this.X,t/n*this.Y)},angle:function(){return Math.atan2(this.X,-this.Y)},rotate:function(e){return this.X==0&&(this.X+=gSaw.utility.EPSILON),this.Y==0&&(this.Y+=gSaw.utility.EPSILON),new gSaw.geometry.Vector2d(Math.cos(e)*this.X-Math.sin(e)*this.Y,Math.sin(e)*this.X+Math.cos(e)*this.Y)},rotatePivot:function(e,t,n){this.X==0&&(this.X+=gSaw.utility.EPSILON),this.Y==0&&(this.Y+=gSaw.utility.EPSILON);var e,t;return srcX=this.X,srcY=this.Y,srcX-=e,srcY-=t,new gSaw.geometry.Vector2d(Math.cos(n)*srcX-Math.sin(n)*srcY+e,Math.sin(radus)*srcX+Math.cos(n)*srcY+t)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.arc(this.X,this.Y,0,Math.PI*2,!0),e.fill()},renderDirection:function(e,t){var n=gSaw.CURRENT_CONTEXT;n.beginPath(),n.moveTo(e,t),n.lineTo(e+this.X,t+this.Y),n.stroke()},renderArrow:function(e,t){var n,r;n=gSaw.CURRENT_CONTEXT,this.renderDirection(e,t),r=new gSaw.geometry.Vector2d(this.X,this.Y),r=r.normalize(),r=r.rotate(gSaw.utility.degreeToRadian(30)),n.beginPath(),n.moveTo(e+this.X,t+this.Y),n.lineTo(e+this.X-r.X*10,t+this.Y-r.Y*10),n.closePath(),n.stroke(),r=r.rotate(gSaw.utility.degreeToRadian(-60)),n.beginPath(),n.moveTo(e+this.X,t+this.Y),n.lineTo(e+this.X-r.X*10,t+this.Y-r.Y*10),n.closePath(),n.stroke()},renderDestination:function(e,t){var n=gSaw.CURRENT_CONTEXT;n.beginPath(),n.arc(e+this.X,t+this.Y,2,0,Math.PI*2,!0),n.fill()}};return n},Bezier:function(e,t,n,r){var i={START:new gSaw.geometry.Vector2d(e.X,e.Y),END:new gSaw.geometry.Vector2d(r.X,r.Y),CONTROL1:new gSaw.geometry.Vector2d(t.X,t.Y),CONTROL2:new gSaw.geometry.Vector2d(n.X,n.Y),RENDER_INCR:.01,getPoint:function(e){if(e!=0){var t,e,n,r,i,s;t=1-e,tt=e*e,n=t*t,r=n*t,i=tt*e,s=this.START.scale(r),s=s.add(this.CONTROL1.scale(3*n*e)),s=s.add(this.CONTROL2.scale(3*t*tt)),s=s.add(this.END.scale(i))}else s=this.START;return s},setStartPoint:function(e,t){this.START.setPosition(e,t)},setEndPoint:function(e,t){this.END.setPosition(e,t)},setControlPoint:function(e,t,n){this["CONTROL"+e].setPosition(t,n)},setRenderStep:function(e){this.RENDER_INCR=e},render:function(){var e,t,n=gSaw.CURRENT_CONTEXT;e=0,t=1/this.RENDER_INCR,n.beginPath(),n.moveTo(this.START.X,this.START.Y);for(e;e<t;e++){var r=this.getPoint(e*this.RENDER_INCR);n.lineTo(r.X,r.Y)}n.lineTo(this.END.X,this.END.Y),n.stroke()},renderEdit:function(){var e,t,n=gSaw.CURRENT_CONTEXT;e=0,t=1/this.RENDER_INCR,n.beginPath(),n.moveTo(this.START.X,this.START.Y);for(e;e<t;e++){var r=this.getPoint(e*this.RENDER_INCR);n.lineTo(r.X,r.Y)}n.lineTo(this.END.X,this.END.Y),n.stroke(),n.save(),n.lineWidth=1,n.beginPath(),n.arc(this.CONTROL1.X,this.CONTROL1.Y,4,2*Math.PI,!1),n.stroke(),n.beginPath(),n.arc(this.CONTROL2.X,this.CONTROL2.Y,4,2*Math.PI,!1),n.stroke(),n.beginPath(),n.moveTo(this.START.X,this.START.Y),n.lineTo(this.CONTROL1.X,this.CONTROL1.Y),n.stroke(),n.beginPath(),n.moveTo(this.END.X,this.END.Y),n.lineTo(this.CONTROL2.X,this.CONTROL2.Y),n.stroke(),n.restore(),n.fillRect(this.START.X-3,this.START.Y-3,6,6),n.fillRect(this.END.X-3,this.END.Y-3,6,6)}};return i},Path:function(){var e={segments:new Array,addLine:function(e){if(this.segments.length!=0){var t=this.segments[this.segments.length-1];console.log(t),t.type=="line"?e.setStartPoint(t.object.POINT2.X,t.object.POINT2.Y):e.setStartPoint(t.object.END.X,t.object.END.Y)}var n={object:e,type:"line"};this.segments.push(n)},addBezier:function(e){if(this.segments.length!=0){var t=this.segments[this.segments.length-1];t.type=="line"?e.setStartPoint(t.object.POINT2.X,t.object.POINT2.Y):e.setStartPoint(t.object.END.X,t.object.END.Y)}var n={object:e,type:"bezier"};this.segments.push(n)},getSegmentPoints:function(){var e,t,n;e=new Array,t=0,n=this.getLength(),e.push(this.getStartPoint());for(t;t<n;t+=1)e.push(this.segments[t].object.getPoint(1));return e},getControlPoints:function(){var e,t,n,r;e=new Array,control1=new Array,control2=new Array,t=0,n=this.getLength();for(t;t<n;t+=1)this.segments[t].type=="bezier"&&(control1.point=new gsPoint(this.segments[t].object.CONTROL1.X,this.segments[t].object.CONTROL1.Y),control1.segment=t,control1.pos=1,e.push(control1),control1=new Array,control2.point=new gsPoint(this.segments[t].object.CONTROL2.X,this.segments[t].object.CONTROL2.Y),control2.segment=t,control2.pos=2,e.push(control2),control2=new Array);return e},getStartPoint:function(){return this.segments[0].object.getPoint(0)},getEndPoint:function(){return this.segments[this.segments.length-1].object.getPoint(1)},setSegmentPoint:function(e,t,n){e==0?this.segments[0].object.setStartPoint(t,n):e==this.getLength()?this.segments[e-1].object.setEndPoint(t,n):(this.segments[e].object.setStartPoint(t,n),this.segments[e-1].object.setEndPoint(t,n))},setControlPoint:function(e,t,n,r){this.segments[t].object.setControlPoint(e,n,r)},getPoint:function(e){var t,n,r;r=this.segments.length,e!=0?(t=Math.floor(e),n=e-t):(t=0,n=.1);if(e>r||e==r)t=e,t--,n=1;return this.segments[t].object.getPoint(n)},removeLast:function(){this.segments.pop()},removeFirst:function(){this.segments.shift()},getLength:function(){return this.segments.length},render:function(){var e,t;e=0,t=this.segments.length;for(e;e<t;e+=1)this.segments[e].object.render()},renderEdit:function(){var e,t;e=0,t=this.segments.length;for(e;e<t;e+=1)this.segments[e].object.renderEdit()},importJson:function(e){i=0,length=e.length;for(i;i<length;i+=1){var t=e[i];if(t.type=="bezier"){var n=new gsBezier(t.object.START,t.object.CONTROL1,t.object.CONTROL2,t.object.END);this.addBezier(n)}else if(t.type=="line"){var r=new gsLine(t.object.POINT1.X,t.object.POINT1.Y,t.object.POINT2.X,t.object.POINT2.Y);this.addLine(r)}}}};return e}},gsPoint=gSaw.geometry.Point,gsLine=gSaw.geometry.Line,gsRectangle=gSaw.geometry.Rectangle,gsCircle=gSaw.geometry.Circle,gsPolygon=gSaw.geometry.Polygon,gsAABB=gSaw.geometry.AABB,gsVector2d=gSaw.geometry.Vector2d,gsBezier=gSaw.geometry.Bezier,gsPath=gSaw.geometry.Path,gSaw.ui={Button:function(e,t,n,r,i){var s={area:new gSaw.geometry.Rectangle(e,t,n,r),callback:null,mouseOver:!1,images:null,title:i||"",coolDown:0,update:function(e){var t,n;t=new gsPoint(gSaw.CORE_MOUSE_MANAGER.X,gSaw.CORE_MOUSE_MANAGER.Y),n=gSaw.CORE_MOUSE_MANAGER.MB[0],this.mouseOver=gsCollide.PointRectangle(t,this.area),this.mouseOver&&n&&this.coolDown<=0&&(this.callback(),this.coolDown=gSaw.UI_COOLDOWN),this.coolDown>0&&(this.coolDown-=e)},setImages:function(e){this.images=e},setTitle:function(e){this.title=e},setCallback:function(e){this.callback=e},setArea:function(e,t,n,r){this.area.setPosition(e,t),this.area.setWidth(n),this.area.setHeight(r)},setImage:function(e){this.images[0]=e},setMouseOverImage:function(e){this.images[1]=e},render:function(){var e=gSaw.CURRENT_CONTEXT;e.save(),this.images==null?this.mouseOver?(e.strokeStyle="red",this.area.render()):(e.strokeStyle="black",this.area.render()):this.mouseOver?this.images[1].render(this.area.POS.getX(),this.area.POS.getY()):this.images[0].render(this.area.POS.getX(),this.area.POS.getY()),this.title!=""&&(e.textAlign="center",e.fillText(this.title,this.area.POS.getX()+this.area.getWidth()/2,this.area.POS.getY()+5+this.area.getHeight()/2)),e.restore()}};return s},CheckBox:function(e,t){var n={area:new gSaw.geometry.Rectangle(e,t,20,20),check:new gSaw.geometry.Polygon,selected:!1,callback:null,image:new Array,mouseOver:!1,coolDown:0,init:function(){var e,t;e=this.area.POS.getX(),t=this.area.POS.getY(),this.check.addPoint(e+0,t+8),this.check.addPoint(e+8,t+6),this.check.addPoint(e+12,t+12),this.check.addPoint(e+20,t-6),this.check.addPoint(e+14,t+18)},setCallback:function(e){this.callback=e},setPosition:function(e,t){this.area.POS.setPosition(e,t)},update:function(e){var t,n;t=new gsPoint(gSaw.CORE_MOUSE_MANAGER.X,gSaw.CORE_MOUSE_MANAGER.Y),n=gSaw.CORE_MOUSE_MANAGER.MB[0],this.mouseOver=gsCollide.PointRectangle(t,this.area),this.mouseOver&&n&&this.coolDown<=0&&(this.callback!=null&&this.callback(),this.selected?this.selected=!1:this.selected=!0,this.coolDown=1e3),this.coolDown>0&&(this.coolDown-=e)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.save(),this.mouseOver?e.strokeStyle="red":e.strokeStyle="black",this.area.render(),this.selected&&this.check.fill(),e.restore()}};return n.init(),n},RadioGroup:function(e,t){var n={POS:new gSaw.geometry.Point(e,t),buttons:new Array,addButton:function(e){var t,n;n=this.buttons.length,t=new gSaw.ui.RadioButton(this.POS.getX()+n*40,this.POS.getY(),this,e),this.buttons.push(t),this.check(e)},removeButton:function(e){this.buttons.slice(1,e)},check:function(e){var t,n;t=0,n=this.buttons.length;for(t;t<n;t+=1)this.buttons[t].getId()==e?this.buttons[t].setSelected(!0):this.buttons[t].setSelected(!1)},update:function(e){var t,n;t=0,n=this.buttons.length;for(t;t<n;t+=1)this.buttons[t].update(e)},render:function(){var e,t;e=0,t=this.buttons.length;for(e;e<t;e+=1)this.buttons[e].render()}};return n},RadioButton:function(e,t,n,r){var i={area:new gSaw.geometry.Circle(e,t,10),check:new gSaw.geometry.Circle(e,t,6),parent:n,id:r,mouseOver:!1,coolDown:0,selected:!1,setPosition:function(e,t){this.area.POS.setPosition(e,t),this.check.POS.setPosition(e,t)},getId:function(){return this.id},setSelected:function(e){this.selected=e},update:function(e){var t,n;t=new gsPoint(gSaw.CORE_MOUSE_MANAGER.X,gSaw.CORE_MOUSE_MANAGER.Y),n=gSaw.CORE_MOUSE_MANAGER.MB[0],this.mouseOver=gsCollide.PointCircle(t,this.area),this.mouseOver&&n&&this.coolDown<=0&&(this.callback!=null&&this.callback(),this.parent.check(this.id),this.coolDown=1e3),this.coolDown>0&&(this.coolDown-=e)},render:function(){var e=gSaw.CURRENT_CONTEXT;e.save(),this.mouseOver?e.strokeStyle="red":e.strokeStyle="black",this.area.render(),this.selected&&this.check.fill(),e.restore()}};return i}},gsButton=gSaw.ui.Button,gsCheckBox=gSaw.ui.CheckBox,gsRadioGroup=gSaw.ui.RadioGroup,gsRadioButton=gSaw.ui.RadioButton,gSaw.collision={PointCircle:function(e,t){var n,r;return n=new gSaw.geometry.Vector2d(e.X,e.Y),r=new gSaw.geometry.Vector2d(t.POS.X,t.POS.Y),n.subtract(r).length()<t.RADIUS},PointRectangle:function(e,t){return e.X>t.POS.X&&e.X<t.POS.X+t.WIDTH&&e.Y>t.POS.Y&&e.Y<t.POS.Y+t.HEIGHT},CircleCircle:function(e,t){var n,r;return n=new gSaw.geometry.Vector2d(e.POS.getX(),e.POS.getY()),r=new gSaw.geometry.Vector2d(t.POS.getX(),t.POS.getY()),n.subtract(r).length()<e.RADIUS+t.RADIUS}},gsCollide=gSaw.collision,gSaw.utility={EPSILON:1e-6,radianToDegree:function(e){return e*(180/Math.PI)},degreeToRadian:function(e){return e*(Math.PI/180)},distance:function(e,t){var n=new gSaw.geometry.Vector2d(e.X,e.Y);return n=n.subtract(new gSaw.geometry.Vector2d(t.X,t.Y)),n.length()},fontSize:function(){var e,t}},gsUtil=gSaw.utility;